"use strict";var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}();function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var Mention=function(){function t(i){_classCallCheck(this,t);this.options=i.options||[],this.input=i.input,this.reverse=i.reverse,this.symbol=i.symbol||"@",this.cursorPosition=0,this.hover=0,this.showingOptions=!1,this.upDownStay=0,this.wordAtCursor={},this.update=i.update||function(){},this.match=i.match||this.match,this.template=i.template||this.template,this.html={input:void 0,display:void 0,wrapper:void 0,optionsList:void 0,options:[],spans:[]},this.setupHTML(),this.listen()}return _createClass(t,[{key:"match",value:function(t,i){var e=i.name||i;return!t.length||e.toLowerCase().startsWith(t.replace("@","").toLowerCase())}},{key:"template",value:function(t){return t.name||t}},{key:"setupHTML",value:function(){this.html.input=this.input,this.html.wrapper=document.createElement("div"),this.html.wrapper.classList.add("mention-wrapper"),this.html.input.parentElement.insertBefore(this.html.wrapper,this.html.input),this.html.wrapper.appendChild(this.html.input),this.html.optionsList=document.createElement("div"),this.html.optionsList.classList.add("mention-options"),this.html.wrapper.appendChild(this.html.optionsList),this.reverse&&(this.html.optionsList.classList.add("mention-options-reverse"),this.html.wrapper.insertBefore(this.html.optionsList,this.html.wrapper.firstChild));var t=!0,i=!1,e=void 0;try{for(var n,s=this.options[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var o=n.value,r=document.createElement("div");r.classList.add("mention-option"),r.innerHTML=this.template(o),r.setAttribute("mentiondata",JSON.stringify(o)),this.html.options.push(r),this.html.optionsList.appendChild(r)}}catch(t){i=!0,e=t}finally{try{!t&&s.return&&s.return()}finally{if(i)throw e}}}},{key:"listen",value:function(){var t=this;this.html.input.addEventListener("input",function(){t.onEventInput()}),this.html.input.addEventListener("keydown",function(i){t.onEventKeyDown(i)}),this.html.input.addEventListener("keyup",function(i){t.onEventKeyUp(i)}),this.html.options.forEach(function(i){i.addEventListener("click",function(i){t.onEventOptionClick(i.target)})})}},{key:"onEventInput",value:function(){this.update()}},{key:"onEventKeyDown",value:function(t){if(this.upDownStay=40==t.keyCode?1:38==t.keyCode?-1:0,this.reverse&&(this.upDownStay*=-1),this.upDownStay&&this.showingOptions&&t.preventDefault(),13==t.keyCode&&this.showingOptions){t.preventDefault();var i=this.html.options.find(function(t){return t.classList.contains("hover")});i&&this.onEventOptionClick(i)}}},{key:"onEventKeyUp",value:function(){this.cursorPositionChanged(),this.setHoverOption()}},{key:"onEventOptionClick",value:function(t){var i=this.symbol+JSON.parse(t.getAttribute("mentiondata")).name+" ",e=this.html.input.value.split("");e.splice(this.wordAtCursor.index,this.wordAtCursor.word.length,i),this.html.input.value=e.join(""),this.html.input.focus(),this.setCursorPosition(this.wordAtCursor.index+i.length+1),this.toggleOptions(!1),this.update()}},{key:"onEventScroll",value:function(){}},{key:"cursorPositionChanged",value:function(){this.cursorPosition=this.html.input.selectionStart,this.wordAtCursor=this.readWordAtCursor({cursorPosition:this.cursorPosition,value:this.input.value}),this.toggleOptions(this.wordAtCursor.word.length&&this.wordAtCursor.word[0]==this.symbol),this.optionsMatch()}},{key:"toggleOptions",value:function(t){this.html.optionsList.classList.remove("show"),t&&this.html.optionsList.classList.add("show"),this.showingOptions=t}},{key:"optionsMatch",value:function(){for(var t in this.options){var i=this.wordAtCursor.word.replace("@","");this.html.options[t].classList.remove("show"),this.match(i,this.options[t])&&this.html.options[t].classList.add("show")}}},{key:"setHoverOption",value:function(){var t=this.html.options.filter(function(t){return t.classList.remove("hover"),t.classList.contains("show")});t.length?(this.hover=this.upDownStay?this.hover+this.upDownStay:0,this.hover<0&&(this.hover=t.length-1),this.hover==t.length&&(this.hover=0),t[this.hover].classList.add("hover")):this.toggleOptions(!1)}},{key:"setCursorPosition",value:function(t){this.cursorPosition=t,this.html.input.setSelectionRange(t,t)}},{key:"collect",value:function(){return findMatches().filter(function(t){})}},{key:"findMatches",value:function(){var t=this.html.input.value.split("").concat([" "]),i=[],e="";for(var n in t){var s=t[n],o=t[n-1]||" ",r=[" ","\\n"].indexOf(o)>-1||10==o.charCodeAt(0);(s.includes(this.symbol)&&r||e.length)&&" "!=s&&(e+=s),e.length&&" "==s&&(i.unshift({word:e,index:Math.max(n-e.length,0)}),e="")}return i}},{key:"readWordAtCursor",value:function(t){for(var i="",e=t.cursorPosition,n=t.value.replace(/\n/g," ");e--;){if(" "==n[e]||e<0)break}for(;e++<n.length-1;){var s=n[e];if(" "==s)break;i+=s}return{index:Math.max(e-i.length,0),word:i}}}]),t}();"undefined"!=typeof module&&(module.exports=Mention);